{"version":3,"sources":["../../src/utils.ts","../../src/reducer.ts","../../src/provider.tsx","../../src/useUnidata.tsx","logger.js","counter.js","model/todos.js","addTodo.js","todoList.js","unrelatedCounter.js","App.js","index.js"],"names":["generateDataState","newData","shortid","getDisplayName","prefix","Component","initializer","initialData","data","state","reducer","unidata","updater","action","UnidataContext","createContext","store","dispatch","UnidataProvider","children","useReducer","value","subscribe","subscribed","WrappedComponent","MemoizedUnidataComponent","props","useContext","changedData","subscribedData","v","k","hasChanged","Object","subscribedState","useEffect","useUnidata","parentProps","SubscribedComponent","createLogger","content","logs","id","generate","time","Date","writtenLogs","lastContent","forEach","l","i","push","count","currentContent","length","map","log","key","toLocaleTimeString","Counter","this","todos","filter","t","completed","React","PureComponent","CheckboxField","e","target","checked","setValue","Field","label","validators","test","required","errorMessage","minlen","type","todo","useModel","todoModel","change","extractFromEvent","onChange","name","onClick","preventDefault","isValid","todoData","clearData","error","message","parseInt","counter","increase","useCallback","App","colStyles","padding","flexGrow","width","position","style","display","height","alignItems","href","right","top","src","alt","data-recalc-dims","color","backgroundColor","overflowY","boxShadow","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.b039e537.chunk.js","sourcesContent":["import shortid from 'shortid'\nimport { mapValues } from 'lodash'\nimport { DataCollection, DataStateCollection } from './types'\n\nexport const generateDataState = (\n  newData: DataCollection\n): DataStateCollection =>\n  mapValues(newData, () => shortid.generate()) as DataStateCollection\n\nexport const getDisplayName = (\n  prefix: string,\n  Component: React.ElementType\n) => {\n  return `${prefix}${\n    (Component as React.FC).displayName ||\n    (Component as React.FC).name ||\n    'Component'\n  }`\n}\n","import { DataCollection, UnidataType, UnidataAction } from './types'\nimport { generateDataState } from './utils'\n\nexport const initializer = (initialData: DataCollection) => {\n  return { data: initialData, state: generateDataState(initialData) }\n}\n\nconst updater = (unidata: UnidataType, newData: DataCollection) => {\n  return {\n    data: {\n      ...unidata.data,\n      ...newData,\n    },\n    state: {\n      ...unidata.state,\n      ...generateDataState(newData),\n    },\n  }\n}\n\nexport const reducer = (\n  unidata: UnidataType,\n  action: UnidataAction\n): UnidataType => {\n  const updatedData = action(unidata.data)\n  return updater(unidata, updatedData)\n}\n","import React, { createContext, PropsWithChildren, useReducer } from 'react'\n\nimport { UnidataProviderProps, UnidataContextType } from './types'\nimport { reducer, initializer } from './reducer'\n\nexport const UnidataContext = createContext<UnidataContextType>({\n  store: {\n    data: {},\n    state: {},\n  },\n\n  dispatch: () => {},\n})\nUnidataContext.displayName = 'UnidataContext'\n\n/**\n * Wrapper of UnidataContext.Provider\n * @param {UnidataProviderProps} props\n */\nexport const UnidataProvider = ({\n  initialData,\n  children,\n}: PropsWithChildren<UnidataProviderProps>) => {\n  const [store, dispatch] = useReducer(reducer, initialData, initializer)\n\n  return (\n    <UnidataContext.Provider value={{ store, dispatch }}>\n      {children}\n    </UnidataContext.Provider>\n  )\n}\n","import { mapValues, values, pick } from 'lodash'\nimport React, { useContext, useEffect } from 'react'\nimport { UnidataContext } from './provider'\nimport {\n  SubscribedComponentProps,\n  DataCollection,\n  UnidataAction,\n} from './types'\nimport { getDisplayName } from './utils'\n\n/**\n * Hooks to return data the Component is listening to, state key, and data setter functions\n * @param {DataCollection} subscribed Data which the component want to subscribe to. { name: defaultValue }\n */\nexport const useUnidata = (\n  subscribed: DataCollection = {}\n): [DataCollection, React.Dispatch<UnidataAction>, string] => {\n  const { dispatch, store } = useContext(UnidataContext)\n  const { data, state } = store\n\n  const changedData: DataCollection = {}\n  const subscribedData = mapValues(subscribed, (v, k) => {\n    if (data[k] !== undefined || data[k] === v) return data[k]\n    changedData[k] = v\n    return v\n  })\n\n  const hasChanged = Object.keys(changedData).length > 0\n\n  const subscribedState = values(pick(state, Object.keys(subscribed))).join('-')\n\n  useEffect(() => {\n    if (hasChanged) {\n      dispatch(() => changedData)\n    }\n  }, [hasChanged, dispatch, changedData])\n\n  return [subscribedData, dispatch, subscribedState]\n}\n\n/**\n * Subscribe this component to specific data. Once those data change, Component will be rerender\n * @param {DataCollection} subscribed Data which the component want to subscribe to. { name: defaultValue }\n */\nexport const subscribe = (subscribed?: DataCollection) => (\n  WrappedComponent: React.ElementType\n) => {\n  const MemoizedUnidataComponent = (props: object): JSX.Element => {\n    const [data, dispatch, state] = useUnidata(subscribed || {})\n    const parentProps = { ...props }\n\n    const SubscribedComponent: React.ElementType<SubscribedComponentProps> = () => (\n      <WrappedComponent data={data} dispatch={dispatch} {...parentProps} />\n    )\n    SubscribedComponent.displayName = getDisplayName(\n      'UnidataSubscribed',\n      WrappedComponent\n    )\n    return React.useMemo(() => <SubscribedComponent state={state} />, [state])\n  }\n  MemoizedUnidataComponent.displayName = getDisplayName(\n    'UnidataMemoized',\n    WrappedComponent\n  )\n  return MemoizedUnidataComponent\n}\n","import React from 'react'\nimport { subscribe } from '@datnq/unidata'\nimport shortid from 'shortid'\n\nexport const createLogger = (dispatch) => (content) =>\n  dispatch(({ logs = [] }) => {\n    return {\n      logs: [...logs, { content, id: shortid.generate(), time: new Date() }],\n    }\n  })\n\nexport default subscribe({ logs: [] })(({ data }) => {\n  const { logs = [] } = data\n\n  const writtenLogs = []\n  let lastContent\n\n  logs.forEach((l, i) => {\n    if (i === 0) {\n      writtenLogs.push({ ...l, count: 1 })\n      lastContent = l.content\n      return\n    }\n    const currentContent = l.content\n    if (lastContent && currentContent === lastContent) {\n      writtenLogs[writtenLogs.length - 1].count += 1\n      writtenLogs[writtenLogs.length - 1].time = new Date()\n    } else {\n      writtenLogs.push({ ...l, count: 1 })\n      lastContent = currentContent\n    }\n  })\n\n  return (\n    writtenLogs && (\n      <div>\n        {writtenLogs.map((log) => (\n          <p key={log.id}>\n            <code>{log.time.toLocaleTimeString()}</code> &ndash; {log.content}\n            {log.count > 1 ? ` (${log.count})` : ''}\n          </p>\n        ))}\n      </div>\n    )\n  )\n})\n","import React from 'react'\nimport { subscribe } from '@datnq/unidata'\nimport { createLogger } from './logger'\n\nclass Counter extends React.PureComponent {\n  constructor(props) {\n    super(props)\n    this.log = createLogger(this.props.dispatch)\n  }\n  componentDidMount() {\n    this.log && this.log('Rendering Todo Counter')\n  }\n  render() {\n    const { data } = this.props\n    return (\n      <span>\n        Completed: {data.todos.filter((t) => t.completed).length}/\n        {data.todos.length}\n      </span>\n    )\n  }\n}\n\nexport default subscribe({\n  todos: [],\n})(Counter)\n","import { required, minlen } from '@datnq/usemodel/dist/validators.ts'\nimport { Field } from '@datnq/usemodel'\n\nclass CheckboxField extends Field {\n  extractFromEvent(e) {\n    const {\n      target: { value, checked },\n    } = e\n    this.setValue(checked ? value : null)\n  }\n}\n\nexport default () => {\n  return {\n    content: {\n      label: 'Todo Content',\n      validators: [\n        { test: required(), errorMessage: '%(label)s is required' },\n        {\n          test: minlen(6),\n          errorMessage: '%(label)s must be longer than 6 characters',\n        },\n      ],\n    },\n    completed: {\n      label: 'Completed',\n      type: CheckboxField,\n    },\n  }\n}\n","/* eslint-disable jsx-a11y/label-has-associated-control */\nimport React, { useEffect } from 'react'\nimport { useModel } from '@datnq/usemodel'\nimport { subscribe } from '@datnq/unidata'\nimport todoModel from './model/todos'\nimport { createLogger } from './logger'\n\nconst AddTodo = ({ dispatch }) => {\n  const log = createLogger(dispatch)\n\n  const todo = useModel(todoModel)\n  const { content, completed } = todo\n\n  const change = (e) => {\n    todo.extractFromEvent(e)\n  }\n\n  const addtodo = (e) => {\n    e.preventDefault()\n    if (!todo.isValid) return\n\n    const todoData = todo.data\n    dispatch(({ todos }) => {\n      return {\n        todos: [...todos, todoData],\n      }\n    })\n    todo.clearData()\n  }\n\n  useEffect(() => {\n    log('Rendering Add Todo')\n  })\n\n  return (\n    <div>\n      <input\n        type='text'\n        onChange={change}\n        name={content.name}\n        value={content.value}\n      />\n      <label>\n        <input\n          type='checkbox'\n          name={completed.name}\n          checked={completed.value === 'completed'}\n          value='completed'\n          onChange={change}\n        />{' '}\n        Completed\n      </label>\n      <button type='button' onClick={addtodo}>\n        Add todo\n      </button>\n      <br />\n      {content.isValid ? null : <p>{content.error.message}</p>}\n    </div>\n  )\n}\nexport default subscribe()(AddTodo)\n","import React, { useEffect } from 'react'\nimport { subscribe } from '@datnq/unidata'\nimport { createLogger } from './logger'\n\nconst TodoList = ({ data, dispatch }) => {\n  const { todos } = data\n\n  const log = createLogger(dispatch)\n\n  const change = (e) => {\n    const {\n      target: { checked, value },\n    } = e\n\n    dispatch(({ todos, logs }) => {\n      const index = parseInt(value, 10)\n      todos[index].completed = checked\n      return { todos }\n    })\n  }\n\n  useEffect(() => {\n    log('Rendering Todo list')\n  })\n\n  return (\n    <ol>\n      {todos.map((todo, id) => (\n        <li key={todo.content}>\n          <input\n            type='checkbox'\n            checked={todo.completed}\n            value={id}\n            onChange={change}\n          />\n          {todo.completed ? <s>{todo.content}</s> : todo.content}\n        </li>\n      ))}\n    </ol>\n  )\n}\nexport default subscribe({\n  todos: [],\n})(TodoList)\n","import React, { useCallback, useEffect } from 'react'\nimport { subscribe } from '@datnq/unidata'\nimport { createLogger } from './logger'\n\nexport default subscribe({ counter: 0 })(({ data, dispatch }) => {\n  const log = createLogger(dispatch)\n\n  const increase = useCallback(() => {\n    dispatch(({ counter }) => {\n      return {\n        counter: counter + 1,\n      }\n    })\n  }, [dispatch])\n\n  useEffect(() => {\n    log('Rendering Unrelated counter')\n  })\n\n  return (\n    <p>\n      <button type='button' onClick={increase}>\n        + Increase\n      </button>\n      {' ' + data.counter}\n    </p>\n  )\n})\n","import React from 'react'\nimport Counter from './counter'\nimport AddTodo from './addTodo'\nimport TodoList from './todoList'\nimport UnrelatedCounter from './unrelatedCounter'\nimport Logger from './logger'\n\nexport default function App() {\n  const colStyles = {\n    padding: '20px',\n    flexGrow: 1,\n    width: '50%',\n    position: 'relative',\n  }\n  return (\n    <>\n      <div style={{ display: 'flex', height: '100vh', alignItems: 'stretch' }}>\n        <div style={colStyles}>\n          <a\n            href='https://github.com/datnq/unidata'\n            style={{ position: 'absolute', right: 0, top: 0 }}\n          >\n            <img\n              width='149'\n              height='149'\n              src='https://github.blog/wp-content/uploads/2008/12/forkme_right_darkblue_121621.png?resize=149%2C149'\n              alt='Fork me on GitHub'\n              data-recalc-dims='1'\n            />\n          </a>\n          <AddTodo />\n          <hr />\n          <Counter />\n          <UnrelatedCounter />\n          <TodoList />\n        </div>\n        <div\n          style={{\n            ...colStyles,\n            color: '#fff',\n            backgroundColor: '#333',\n            overflowY: 'scroll',\n            boxShadow: 'inset 0 0 20px rgba(0,0,0,.4)',\n          }}\n        >\n          <h2>Rendering logger</h2>\n          <Logger />\n        </div>\n      </div>\n    </>\n  )\n}\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport { UnidataProvider } from '@datnq/unidata'\n\nimport App from './App'\nimport './index.css'\n\nReactDOM.render(\n  <UnidataProvider initialData={{}}>\n    <App />\n  </UnidataProvider>,\n  document.getElementById('root')\n)\n"],"sourceRoot":""}